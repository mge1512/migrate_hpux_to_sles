
## Disk, LVM, and Filesystems (HP LVM/VxFS vs. Linux LVM/Btrfs/Snapper)

### HP LVM vs. Linux LVM2

Linux LVM was originally based on HP-UX LVM, so the concepts map 1:1, but the limitations differ.

| Feature | HP-UX LVM | SLES 16 LVM2 | Critical Difference |
| :---- | :---- | :---- | :---- |
| **Physical Volume** | pvcreate /dev/rdsk/c2t0d0 | pvcreate /dev/sdb | Linux uses block devices, not raw (r) devices for LVM. |
| **Volume Group** | vgcreate vg01 /dev/dsk/c2t0d0 | vgcreate vg01 /dev/sdb |  |
| **Logical Volume** | lvcreate \-L 1000 \-n lvol1 vg01 | lvcreate \-L 1G \-n lvol1 vg01 | Linux accepts human-readable sizes (G, M, T). |
| **Extend** | lvextend \-L 2000 /dev/vg01/lvol1 | lvextend \-L \+1G /dev/vg01/lvol1 | Linux syntax \+1G allows relative extension. |
| **Max Extents** | Rigid max\_pe set at creation. | Virtually unlimited (64-bit). | HP-UX often requires recreating the VG if max\_pe is exceeded. Linux does not.27 |
| **Device Nodes** | /dev/vg01/lvol1 (Character & Block) | /dev/vg01/lvol1 (Symlink to dm device) | Linux uses Device Mapper (/dev/dm-5). |

### The Root Filesystem: Btrfs and Subvolumes

HP-UX 11i v3 defaults to VxFS (Veritas), utilizing Extent-based allocation and intent logging. SLES 16 defaults to **Btrfs** for the root partition.  
**Why Btrfs?**

1. **Copy-on-Write (CoW):** When a file is modified, Btrfs writes the new data to a free block and then updates the metadata pointer. The old data remains until explicitly freed. This enables instant snapshots.  
2. **Bitrot Protection:** Btrfs calculates checksums for data and metadata. If a block is corrupted on disk, Btrfs detects the mismatch on read (unlike VxFS which might silently return corrupted data).

Disk Layout & Subvolumes:  
In HP-UX, /, /usr, /var, and /tmp are usually separate Logical Volumes (LVs). In SLES 16, they are Subvolumes within a single Btrfs partition.

* subvolid=5 (Top Level)  
* @ (Root filesystem, mounted at /)  
* @/var, @/usr/local, @/tmp (Nested subvolumes)  
* **Crucial:** Certain directories like /var/log and /var/lib/pgsql are created as subvolumes *exempt* from snapshots. This prevents the database or logs from being "rolled back" when the OS is reverted.29

### Snapper: Pre/Post Transactional Rollbacks

This is the "killer feature" for the SLES administrator.

* **The Scenario:** You run zypper update to patch glibc and the kernel. The update completes, but upon reboot, the application fails to start due to a library incompatibility.  
* **HP-UX Recovery:** Requires restoring from an Ignite-UX tape or network image, which takes hours. Or, if you were prudent, switching to an alternate boot disk (split mirror), which requires significant pre-planning.  
* **SLES 16 Recovery (Snapper):**  
  1. Zypper automatically triggered a "Pre" snapshot before the update and a "Post" snapshot after.  
  2. Admin reboots into a read-only snapshot via the GRUB2 menu to verify the old state works.  
  3. Admin runs snapper rollback.  
  4. The system makes the "Pre" snapshot the new default boot target.  
  5. Reboot. Total downtime: Minutes.
For just "undoing" configuration changes, which do not require a reboot, there is an even more lightweight method by running "snapper undochange".

For more information on snapper, please use the SUSE Linux Enterprise documentation at (LINK TO BE DONE)

### UEFI and the /boot/efi Partition

HP-UX on Itanium was one of the first OSs to use EFI. SLES 16 on x86-64 mandates UEFI.

* **Requirement:** A dedicated partition (formatted VFAT/FAT32) mounted at /boot/efi.  
* **Sizing:** While HP-UX EFI partitions were often small, SLES 16 recommendations are **512 MB to 1 GB**.  
  * *Reason:* SLES stores the GRUB2 bootloader shim.efi, grubx64.efi, and potentially kernel images here (though usually kernels stay in /boot on XFS/Btrfs). Linux firmware updates (fwupd) also utilize this space. A partition smaller than 256MB will frequently fail during Service Pack upgrades due to lack of space for temporary boot images.32  
* **Partition Table:** Must be GPT (GUID Partition Table). The legacy MBR (Master Boot Record) is not supported for the boot drive in default SLES 16 UEFI installations.



#### ORIGINAL PLAN

* **8.1 Introduction: From Volume Group to Mount Point**
    * Review of core disk concepts: physical volumes, volume groups, logical volumes, and filesystems.
    * The fundamental difference between proprietary and open-source volume managers.
* **8.2 HP-UX Disk Management**
    * The role and commands of **HP's LVM** (`pvcreate`, `vgcreate`, `lvcreate`).
    * Working with the **Veritas File System (VxFS)** and its journaling features.
    * Traditional partitioning (`disksetup`).
* **8.3 SLES 16 Disk Layout and Modern Linux Standards**
    * **Mandatory Boot Partitions (UEFI):** The requirement for a separate `/boot/efi` partition (often $\approx$ 550 MB).
    * **Recommended OS Layout:** The best practice of having the **OS root (`/`) not on LVM**, but on a dedicated partition using **Btrfs** (recommended size: $\approx$ 64 GiB).
    * **Data Strategy:** Using **Linux LVM** for larger data volumes (`/home`, `/var/lib`, custom application data), similar to the traditional HP-UX approach.
* **8.4 The Power of Btrfs and Snapper**
    * Understanding **Btrfs** (B-tree File System): Copy-on-Write (CoW) and checksumming.
    * The **Snapper** tool: How it leverages Btrfs snapshots for **instant system rollback** (post-patching safety).
    * Snapshot administration: Creating, listing, and rolling back snapshots.
* **8.5 Linux LVM Administration**
    * Core commands: `pvcreate`, `vgcreate`, `lvcreate` (noting the syntactical similarity but internal difference).
    * Resizing and extending Linux Logical Volumes.
* **8.6 Transitioning Data: VxFS to Ext4/XFS/Btrfs**
    * Considerations when migrating data from VxFS to standard Linux filesystems.
* **8.7 Summary: Stability Through Snapshots**





